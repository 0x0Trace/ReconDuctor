# Configuration Guide

Customize Reconductor's settings, tool paths, and workflow parameters.

---

## Table of Contents

- [Orchestrator Configuration](#orchestrator-configuration)
- [Tool Path Configuration](#tool-path-configuration)
- [n8n Workflow Configuration](#n8n-workflow-configuration)
- [Output Directory Configuration](#output-directory-configuration)
- [Scanning Parameters](#scanning-parameters)
- [Environment Variables](#environment-variables)
- [Advanced Configuration](#advanced-configuration)

---

## Orchestrator Configuration

The Python orchestrator (`recon_orchestrator.py`) contains configuration settings at the top of the file.

### Basic Settings

Edit these constants in `recon_orchestrator.py`:

```python
# n8n Connection Settings
N8N_BASE_URL = "http://localhost:5678"

# Webhook Endpoints
WEBHOOK_PHASE1 = f"{N8N_BASE_URL}/webhook/recon-phase1"
WEBHOOK_PHASE3 = f"{N8N_BASE_URL}/webhook/recon-phase3-parallel"

# Output Directory
RECON_OUTPUT_DIR = "/tmp/recon"

# Polling Settings
POLL_INTERVAL = 10        # seconds between status checks
PHASE2_TIMEOUT = 600      # 10 minutes max for Phase 2
PHASE3_TIMEOUT = 900      # 15 minutes for Phase 3
```

### Custom n8n URL

If n8n is running on a different host or port:

```python
# For remote n8n instance
N8N_BASE_URL = "http://192.168.1.100:5678"

# For n8n behind a reverse proxy
N8N_BASE_URL = "https://n8n.yourdomain.com"
```

### Custom Timeouts

Adjust timeouts based on your target size:

```python
# For very large targets (1000+ subdomains)
PHASE2_TIMEOUT = 1200     # 20 minutes
PHASE3_TIMEOUT = 1800     # 30 minutes

# For small targets (< 50 hosts)
PHASE2_TIMEOUT = 300      # 5 minutes
PHASE3_TIMEOUT = 600      # 10 minutes
```

---

## Tool Path Configuration

If reconnaissance tools are not in your `$PATH`, configure their paths in n8n workflows.

### Method 1: Edit n8n Workflows (Recommended)

1. Open n8n at `http://localhost:5678`
2. Open each workflow
3. Locate the "Execute Command" nodes
4. Update the command path

### Workflow-Specific Tool Paths

#### Phase 1: Subdomain Enumeration

**Tools Used**: `subfinder`, `curl`, `jq`

Edit nodes:
- **"Run Subfinder"** → Update command:
  ```bash
  /path/to/subfinder -d "$DOMAIN" -silent -all
  ```

- **"Query crt.sh"** → Update command:
  ```bash
  /usr/bin/curl -s "https://crt.sh/?q=%25.${DOMAIN}&output=json" | /usr/bin/jq
  ```

#### Phase 2: Live Host Validation

**Tools Used**: `httpx`, `dnsx`

Edit nodes:
- **"Run httpx"** → Update command:
  ```bash
  /path/to/httpx -l "$INPUT_FILE" -silent -json -tech-detect
  ```

- **"Run dnsx"** → Update command:
  ```bash
  /path/to/dnsx -l "$INPUT_FILE" -silent -json -a -cname
  ```

#### Phase 3: Vulnerability Scanning

**Tools Used**: `nuclei`

Edit node:
- **"Run Nuclei Scan"** (in Worker workflow) → Update command:
  ```bash
  /path/to/nuclei -l "$TARGETS_FILE" -as -rl 15 -bs 2 -c 10 -silent -jsonl
  ```

### Method 2: Create Symlinks

Create symlinks in `/usr/local/bin/` (requires sudo):

```bash
# Find tool locations
which subfinder  # e.g., /home/user/go/bin/subfinder

# Create symlinks
sudo ln -s /home/user/go/bin/subfinder /usr/local/bin/subfinder
sudo ln -s /home/user/go/bin/httpx /usr/local/bin/httpx
sudo ln -s /home/user/go/bin/dnsx /usr/local/bin/dnsx
sudo ln -s /home/user/go/bin/nuclei /usr/local/bin/nuclei

# Verify
which subfinder  # Should show /usr/local/bin/subfinder
```

### Method 3: Update PATH in n8n Environment

Add tool paths to n8n's environment:

```bash
# Edit n8n systemd service (if using systemd)
sudo systemctl edit n8n

# Add environment variable
[Service]
Environment="PATH=/home/user/go/bin:/usr/local/bin:/usr/bin:/bin"

# Restart n8n
sudo systemctl restart n8n
```

---

## n8n Workflow Configuration

### Webhook URLs

Workflows use these webhook paths (configured in n8n):

| Workflow | Webhook Path | Customize In n8n |
|----------|--------------|------------------|
| Phase 1 | `/webhook/recon-phase1` | Webhook Trigger node |
| Phase 2 | `/webhook/recon-phase2` | Webhook Trigger node |
| Phase 3 | `/webhook/recon-phase3-parallel` | Webhook Trigger node |

**To Change Webhook Paths**:

1. Open workflow in n8n
2. Click the "Webhook" trigger node
3. Change the "Path" field
4. Update `WEBHOOK_PHASE1` or `WEBHOOK_PHASE3` in `recon_orchestrator.py`

### Workflow IDs

Current workflow IDs (as documented in `workflow_configuration.md`):

```javascript
Phase 1: p7dqxf5jY9Pb4vNH
Phase 2: buLRNQbEx1NYjsua
Phase 3 Manager: YiTd4X1k1CF4rNLo
Phase 3 Worker: sCC4a3A0w8hYYqL9
```

**Note**: These IDs are auto-generated by n8n during import. Your IDs may differ.

---

## Output Directory Configuration

### Change Output Location

**Default**: `/tmp/recon/`

**To Change**:

1. **Update Orchestrator**:
   ```python
   # In recon_orchestrator.py
   RECON_OUTPUT_DIR = "/home/user/recon_results"
   ```

2. **Update n8n Workflows**:

   Edit these nodes in **Phase 2** and **Phase 3 Manager** workflows:

   - **"Set Output Paths"** nodes → Change base path:
     ```javascript
     const outputDir = "/home/user/recon_results";
     ```

   - **"Write File"** nodes → Update file paths to use new directory

3. **Create Directory**:
   ```bash
   mkdir -p /home/user/recon_results
   chmod 755 /home/user/recon_results
   ```

### Output File Structure

You can customize filenames in n8n workflows:

```javascript
// Phase 2 Output Files
const phase2Json = `${outputDir}/${domain}/phase2_data.json`;
const phase2Html = `${outputDir}/${domain}/phase2_report.html`;
const phase2Summary = `${outputDir}/${domain}/phase2_summary.txt`;

// Phase 3 Output Files
const phase3Json = `${outputDir}/${domain}/phase3_data.json`;
const phase3Html = `${outputDir}/${domain}/phase3_report.html`;
const phase3Summary = `${outputDir}/${domain}/phase3_summary.txt`;
const phase3Jsonl = `${outputDir}/${domain}/phase3_all_results.jsonl`;
```

---

## Scanning Parameters

### Phase 1: Subdomain Enumeration

**Subfinder Configuration**:

Edit the "Run Subfinder" node in Phase 1 workflow:

```bash
# Current settings
subfinder -d "$DOMAIN" -silent -all

# Add recursive subdomain discovery
subfinder -d "$DOMAIN" -silent -all -recursive

# Limit to specific sources
subfinder -d "$DOMAIN" -silent -sources crtsh,virustotal,censys

# Add rate limiting
subfinder -d "$DOMAIN" -silent -all -rate-limit 10
```

**API Keys** (for better results):

Configure in `~/.config/subfinder/provider-config.yaml`:

```yaml
shodan:
  - YOUR_SHODAN_API_KEY
virustotal:
  - YOUR_VIRUSTOTAL_API_KEY
censys:
  - YOUR_CENSYS_API_ID:YOUR_CENSYS_SECRET
securitytrails:
  - YOUR_SECURITYTRAILS_API_KEY
```

### Phase 2: HTTP/DNS Validation

**httpx Configuration**:

Edit the "Run httpx" node in Phase 2 workflow:

```bash
# Current settings
httpx -l "$INPUT_FILE" -silent -json -tech-detect -status-code -title

# Add screenshot capture
httpx -l "$INPUT_FILE" -silent -json -tech-detect -screenshot

# Add custom timeout
httpx -l "$INPUT_FILE" -silent -json -tech-detect -timeout 10

# Add custom threads
httpx -l "$INPUT_FILE" -silent -json -tech-detect -threads 50
```

**dnsx Configuration**:

```bash
# Current settings
dnsx -l "$INPUT_FILE" -silent -json -a -cname

# Add additional record types
dnsx -l "$INPUT_FILE" -silent -json -a -aaaa -cname -mx -ns -txt

# Add custom resolver
dnsx -l "$INPUT_FILE" -silent -json -a -cname -r 8.8.8.8,1.1.1.1
```

### Phase 3: Vulnerability Scanning

**Nuclei Configuration** (WAF-Safe Defaults):

Edit the "Run Nuclei Scan" node in Phase 3 Worker workflow:

```bash
# Current WAF-safe settings
nuclei \
  -l "$TARGETS_FILE" \
  -as \                       # Automatic scan
  -rl 15 \                    # Rate limit: 15 req/s
  -bs 2 \                     # Bulk size: 2 hosts
  -c 10 \                     # 10 concurrent templates
  -timeout 8 \                # 8 second timeout
  -retries 1 \                # 1 retry
  -s critical,high,medium \   # Severity filter
  -silent -jsonl
```

**Aggressive Scanning** (use with caution):

```bash
# WARNING: May trigger WAFs and IDS
nuclei \
  -l "$TARGETS_FILE" \
  -as \
  -rl 50 \                    # Increased rate limit
  -bs 10 \                    # More hosts at once
  -c 25 \                     # More concurrent templates
  -timeout 5 \                # Faster timeout
  -retries 2 \                # More retries
  -s critical,high,medium,low,info \  # All severities
  -silent -jsonl
```

**Stealth Scanning** (slower, more evasive):

```bash
# Minimal footprint
nuclei \
  -l "$TARGETS_FILE" \
  -as \
  -rl 5 \                     # Very slow rate
  -bs 1 \                     # One host at a time
  -c 5 \                      # Few concurrent templates
  -timeout 15 \               # Patient timeout
  -retries 1 \
  -s critical,high \          # Only high-risk checks
  -silent -jsonl
```

**Custom Template Paths**:

```bash
# Use specific template directory
nuclei -l "$TARGETS_FILE" -t /custom/templates/ -silent -jsonl

# Use specific templates
nuclei -l "$TARGETS_FILE" -t cves/ -t exposures/ -silent -jsonl

# Exclude templates
nuclei -l "$TARGETS_FILE" -as -etags dos,fuzz -silent -jsonl
```

### Worker Pool Configuration

**Default**: 5 workers

To change the number of parallel workers, edit the "IP-Centric Sharding" node in Phase 3 Manager:

```javascript
// Current: 5 workers
const workerCount = 5;

// For more powerful systems (more parallel scans)
const workerCount = 10;

// For resource-constrained systems (fewer parallel scans)
const workerCount = 3;
```

**Note**: More workers = faster, but higher resource usage and increased WAF detection risk.

---

## Environment Variables

Set environment variables for the orchestrator:

```bash
# Export variables
export N8N_URL="http://localhost:5678"
export RECON_OUTPUT="/custom/path"
export PHASE2_TIMEOUT="1200"
export PHASE3_TIMEOUT="1800"

# Make permanent (add to ~/.bashrc)
echo 'export N8N_URL="http://localhost:5678"' >> ~/.bashrc
echo 'export RECON_OUTPUT="/custom/path"' >> ~/.bashrc
source ~/.bashrc
```

Then modify `recon_orchestrator.py` to read from environment:

```python
import os

N8N_BASE_URL = os.getenv('N8N_URL', 'http://localhost:5678')
RECON_OUTPUT_DIR = os.getenv('RECON_OUTPUT', '/tmp/recon')
PHASE2_TIMEOUT = int(os.getenv('PHASE2_TIMEOUT', '600'))
PHASE3_TIMEOUT = int(os.getenv('PHASE3_TIMEOUT', '900'))
```

---

## Advanced Configuration

### Nuclei Template Updates

Configure automatic template updates:

```bash
# Add to crontab for weekly updates
crontab -e

# Add this line (updates every Sunday at 2 AM)
0 2 * * 0 /home/user/go/bin/nuclei -update-templates -silent
```

### Custom HTML Report Styling

Edit the "Generate Final Report" node in Phase 3 Manager to customize HTML:

```javascript
// Modify CSS styles
const htmlReport = `
<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: 'Your-Custom-Font', sans-serif;
      background-color: #your-color;
    }
    /* Add your custom CSS */
  </style>
</head>
<body>
  <!-- Report content -->
</body>
</html>
`;
```

### Logging Configuration

Enable detailed logging in the orchestrator:

```python
# Add at the top of recon_orchestrator.py
import logging

logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('/tmp/recon_orchestrator.log'),
        logging.StreamHandler()
    ]
)
```

### Workflow Execution Limits

Configure n8n execution limits (edit n8n settings):

```bash
# In n8n environment or config file
N8N_EXECUTION_TIMEOUT=3600          # 1 hour max per workflow
N8N_MAX_EXECUTION_DATA_SIZE=52428800  # 50MB max execution data
```

---

## Configuration Files Reference

| File | Purpose | Location |
|------|---------|----------|
| `recon_orchestrator.py` | Orchestrator settings | Project root |
| `workflow_configuration.md` | Workflow documentation | Project root |
| `~/.config/subfinder/provider-config.yaml` | Subfinder API keys | User home |
| `~/.n8n/config` | n8n settings | User home |

---

## Testing Configuration Changes

After making changes:

1. **Restart n8n**:
   ```bash
   # Kill n8n
   pkill -f n8n

   # Restart
   n8n start
   ```

2. **Test with small target**:
   ```bash
   ./recon_orchestrator.py
   # Select mode and test with a small domain (e.g., example.com)
   ```

3. **Check logs**:
   ```bash
   # n8n execution logs
   tail -f ~/.n8n/logs/n8n.log

   # Orchestrator output
   tail -f /tmp/recon_orchestrator.log
   ```

---

## Need Help?

- Configuration not working? See [TROUBLESHOOTING.md](../guides/TROUBLESHOOTING.md)
- Want to understand workflows? See [WORKFLOWS.md](../architecture/WORKFLOWS.md)
- Need usage examples? See [USAGE.md](../getting-started/USAGE.md)

---

**Last Updated**: 2025-12-11
